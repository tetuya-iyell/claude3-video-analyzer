# 動画章立て解析機能の実装

## 概要
Claude3 Video Analyzerに「章立て解析」機能を追加しました。この機能により、動画の内容を構造化された章立て形式で解析し、より整理された形で出力することが可能になりました。

## 主な機能と改善点

### 1. 章立て解析機能の追加
- 動画内容を「概要」「章（複数）」「まとめ」という構造で解析
- 長い動画や複数トピックを含む動画の内容を整理して把握可能
- Claude-3.5モデルの文章構造化能力を活用

### 2. UI改善
- 通常解析/章立て解析を切り替えるタブインターフェース実装
- 解析タイプごとに独立したプロンプト編集エリアを提供
- レスポンシブデザインによる使いやすさの向上

### 3. バックエンド機能拡張
- 章立て解析専用のAPIエンドポイント(`/api/analyze/chapters`)を実装
- 各解析タイプに応じた最適なトークン設定（章立て解析は2048トークンに拡大）
- リアルタイムストリーミングによる段階的な結果表示

### 4. 認証とモデル設定の改善
- AWS BedrockとAnthropic API両方の認証処理強化
- 環境変数から動的にモデルIDを取得する仕組みを実装
- モード別モデル指定(`BEDROCK_MODEL_ID`/`ANTHROPIC_MODEL_ID`)のサポート

### 5. エラーハンドリングの強化
- リクエストコンテキスト問題の根本的解決
- API通信時のエラー詳細表示機能
- 障害発生時の診断情報出力

## 実装詳細

### 章立て解析のサンプルプロンプト
```
これは動画のフレーム画像です。以下の形式で動画を章立てして解説してください。

【形式】
# 動画の概要
（50-100文字程度で動画全体の概要を簡潔に説明）

## 章1：タイトル
（章の内容を説明）

## 章2：タイトル
（章の内容を説明）

（必要に応じて章を追加）

# まとめ
（動画全体のポイントを簡潔にまとめる）
```

### 技術実装のポイント
1. **モデル別処理の最適化**:
   - Bedrockモード: `anthropic.claude-3-5-sonnet-20240620-v1:0` がデフォルト
   - Anthropicモード: `claude-3-sonnet-20240229` がデフォルト
   - 環境変数での上書き機能

2. **APIエンドポイント設計**:
   - 通常解析: `/api/analyze`
   - 章立て解析: `/api/analyze/chapters`
   - 適切なリクエストコンテキスト維持

3. **ストリーミング処理**:
   - Server-Sent Events (SSE) によるリアルタイム表示
   - フレーム抽出と解析の段階的処理

## 設定方法
`.env`ファイルで以下の項目を設定可能:

```
# モード設定 (anthropic または bedrock)
MODE=bedrock

# Bedrockモード用の設定
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_REGION=us-east-1

# Anthropicモード用の設定
ANTHROPIC_API_KEY=your_api_key

# モデル指定
BEDROCK_MODEL_ID=anthropic.claude-3-5-sonnet-20240620-v1:0
ANTHROPIC_MODEL_ID=claude-3-sonnet-20240229
```

## 今後の展望
- より詳細なチャプター分析オプションの追加
- 動画の自動イベント検出機能
- ダウンロード可能なレポート形式の追加
- Gooseフレームワークを活用したAI-Agent機能の実装
  - Agent間の協調的なマルチエージェントによる詳細分析
  - 特定ジャンルに特化した専門知識ベースの解析
  - 検出された場面に対するシナリオ生成と代替案提案
  - ユーザー意図を理解したカスタム解析フローの自動生成